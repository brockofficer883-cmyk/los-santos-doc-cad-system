<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Los Santos Department of Corrections CAD System</title>
<style>
body {
  margin: 0;
  font-family: 'Segoe UI', sans-serif;
  background-color: #0d0d0f;
  color: #e6e6e6;
}
header {
  background: #121212;
  padding: 1rem 2rem;
  display: flex;
  justify-content: space-between;
  align-items: center;
  box-shadow: 0 2px 6px rgba(0,0,0,0.6);
}
header h1 { font-size: 1.3rem; margin: 0; color: #4da6ff; }
nav button {
  background: #1a1a1a;
  border: none;
  color: #ccc;
  padding: 0.5rem 1rem;
  margin: 0 0.25rem;
  cursor: pointer;
  border-radius: 6px;
}
nav button:hover { background: #333; color: #fff; }

.container {
  padding: 1.5rem;
}
.hidden { display: none; }

.card {
  background: #1a1a1d;
  padding: 1rem;
  border-radius: 8px;
  box-shadow: 0 0 10px rgba(0,0,0,0.5);
  margin-bottom: 1.5rem;
}

input, select, textarea {
  background: #0d0d0f;
  color: #fff;
  border: 1px solid #333;
  border-radius: 6px;
  padding: 0.5rem;
  width: 100%;
  margin-bottom: 0.75rem;
}

button.primary {
  background: #0059b3;
  border: none;
  color: #fff;
  padding: 0.6rem 1rem;
  border-radius: 6px;
  cursor: pointer;
}
button.primary:hover { background: #0073e6; }

table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 0.75rem;
}
th, td {
  border: 1px solid #333;
  padding: 0.5rem;
  text-align: left;
}
th { background: #141414; }

#login-screen {
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  background: #0d0d0f;
}
.login-box {
  background: #1a1a1d;
  padding: 2rem;
  border-radius: 10px;
  width: 320px;
  box-shadow: 0 0 15px rgba(0,0,0,0.6);
}
.login-box h2 { color: #4da6ff; text-align: center; margin-bottom: 1rem; }
</style>
</head>
<body>
<div id="login-screen">
  <div class="login-box">
    <h2>DOC System Login</h2>
    <input id="login-username" placeholder="Username" />
    <input id="login-password" type="password" placeholder="Password" />
    <button class="primary" onclick="login()">Login</button>
    <hr />
    <p style="text-align:center;color:#999;">No account? Register below.</p>
    <input id="reg-username" placeholder="New Username" />
    <input id="reg-password" type="password" placeholder="New Password" />
    <select id="reg-rank">
      <option value="Officer">Officer</option>
      <option value="Supervisor">Supervisor</option>
      <option value="Deputy Warden">Deputy Warden</option>
      <option value="Warden">Warden</option>
    </select>
    <button class="primary" onclick="register()">Register</button>
  </div>
</div>

<div id="main" class="hidden">
  <header>
    <h1>Los Santos DOC CAD System</h1>
    <nav>
      <button onclick="showPage('dashboard')">Dashboard</button>
      <button onclick="showPage('inmates')">Inmates</button>
      <button onclick="showPage('dispatch')">Dispatch</button>
      <button onclick="showPage('reports')">Reports</button>
      <button onclick="logout()">Logout</button>
    </nav>
  </header>
  <div class="container">
    <div id="dashboard" class="page">
      <div class="card">
        <h2>Welcome, <span id="officer-name"></span> (<span id="officer-rank"></span>)</h2>
        <p>This is your Los Santos Department of Corrections dashboard.</p>
      </div>
    </div>

    <div id="inmates" class="page hidden">
      <div class="card">
        <h2>Inmate Management</h2>
        <input id="inmate-name" placeholder="Inmate Name" />
        <input id="inmate-sentence" type="number" placeholder="Sentence (minutes)" />
        <button class="primary" onclick="addInmate()">Add Inmate</button>
        <table id="inmate-table">
          <thead><tr><th>Name</th><th>Time Left</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="dispatch" class="page hidden">
      <div class="card">
        <h2>Dispatch Board</h2>
        <input id="call-desc" placeholder="Call Description" />
        <input id="call-location" placeholder="Location" />
        <button class="primary" onclick="addCall()">Add Call</button>
        <table id="call-table">
          <thead><tr><th>Description</th><th>Location</th><th>Time</th><th>Actions</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div id="reports" class="page hidden">
      <div class="card">
        <h2>Incident Reports</h2>
        <textarea id="report-text" placeholder="Write report here..."></textarea>
        <button class="primary" onclick="saveReport()">Submit Report</button>
        <div id="report-list"></div>
      </div>
    </div>
  </div>
</div>

<script>
let currentUser = null;
let inmates = JSON.parse(localStorage.getItem('inmates')||'[]');
let calls = JSON.parse(localStorage.getItem('calls')||'[]');
let reports = JSON.parse(localStorage.getItem('reports')||'[]');
let users = JSON.parse(localStorage.getItem('users')||'[]');

function saveAll() {
  localStorage.setItem('inmates', JSON.stringify(inmates));
  localStorage.setItem('calls', JSON.stringify(calls));
  localStorage.setItem('reports', JSON.stringify(reports));
  localStorage.setItem('users', JSON.stringify(users));
}

function register() {
  const u=document.getElementById('reg-username').value.trim();
  const p=document.getElementById('reg-password').value.trim();
  const r=document.getElementById('reg-rank').value;
  if(!u||!p) return alert('Enter username and password');
  if(users.find(x=>x.username===u)) return alert('Username taken');
  users.push({username:u,password:p,rank:r});
  saveAll();
  alert('Account created!');
}

function login() {
  const u=document.getElementById('login-username').value.trim();
  const p=document.getElementById('login-password').value.trim();
  const found=users.find(x=>x.username===u && x.password===p);
  if(!found){alert('Invalid credentials');return;}
  currentUser=found;
  document.getElementById('login-screen').classList.add('hidden');
  document.getElementById('main').classList.remove('hidden');
  document.getElementById('officer-name').textContent=currentUser.username;
  document.getElementById('officer-rank').textContent=currentUser.rank;
  renderInmates();
  renderCalls();
  renderReports();
}

function logout(){
  currentUser=null;
  document.getElementById('main').classList.add('hidden');
  document.getElementById('login-screen').classList.remove('hidden');
}

function showPage(id){
  document.querySelectorAll('.page').forEach(p=>p.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function addInmate(){
  if(!currentUser) return;
  const name=document.getElementById('inmate-name').value.trim();
  const time=parseInt(document.getElementById('inmate-sentence').value);
  if(!name||isNaN(time)) return alert('Enter name and time');
  inmates.push({name,time});
  saveAll();
  renderInmates();
}

function renderInmates(){
  const tb=document.querySelector('#inmate-table tbody');
  tb.innerHTML='';
  inmates.forEach((i,idx)=>{
    const tr=document.createElement('tr');
    const td1=document.createElement('td');td1.textContent=i.name;
    const td2=document.createElement('td');td2.textContent=i.time+'m';
    const td3=document.createElement('td');
    if(currentUser.rank.includes('Warden')){
      const btn=document.createElement('button');
      btn.textContent='Release';
      btn.onclick=()=>{inmates.splice(idx,1);saveAll();renderInmates();};
      td3.appendChild(btn);
    } else td3.textContent='-';
    tr.append(td1,td2,td3);
    tb.appendChild(tr);
  });
}

setInterval(()=>{
  let changed=false;
